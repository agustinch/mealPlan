// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int               @id @default(autoincrement())
  email           String            @unique
  name            String?
  created_at      DateTime          @default(now()) @db.Timestamp()
  FoodUserStock   FoodUserStock[]
  MealTransaction MealTransaction[]

  @@map("user")
}

model Unit {
  id   Int    @id @default(autoincrement())
  name String
  Food Food[]

  @@map("unit")
}

model Food {
  id              Int               @id @default(autoincrement())
  name            String
  unit            Unit              @relation(fields: [unit_id], references: [id])
  unit_id         Int
  image           String
  Food_Plate      FoodPlate[]
  MealTransaction MealTransaction[]
  FoodUserStock   FoodUserStock[]

  @@map("food")
}

model Plate {
  id              Int               @id @default(autoincrement())
  name            String
  image           String
  FoodPlate       FoodPlate[]
  MealTransaction MealTransaction[]

  @@map("plate")
}

model FoodPlate {
  plate    Plate @relation(fields: [plate_id], references: [id])
  food     Food  @relation(fields: [food_id], references: [id])
  plate_id Int
  food_id  Int
  amount   Int

  @@unique([plate_id, food_id])
  @@map("food_plate")
}

model MealTransaction {
  id         Int      @id @default(autoincrement())
  food       Food     @relation(fields: [food_id], references: [id])
  food_id    Int
  plate      Plate    @relation(fields: [plate_id], references: [id])
  plate_id   Int
  amount     Float
  created_at DateTime @default(now()) @db.Timestamp()
  User       User     @relation(fields: [user_id], references: [id])
  user_id    Int

  @@map("meal_transaction")
}

model FoodUserStock {
  Food    Food  @relation(fields: [food_id], references: [id])
  food_id Int
  User    User  @relation(fields: [user_id], references: [id])
  user_id Int
  amount  Float

  @@unique([food_id, user_id])
  @@map("food_user_stock")
}
